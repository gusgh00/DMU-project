<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Care Bicycle Case</title>

    <link rel="stylesheet" type="text/css" href="../css/header.css" />
    <link rel="stylesheet" type="text/css" href="../css/footer.css" />
    <link rel="stylesheet" type="text/css" href="../css/instyle.css" />
    <link rel="shortcut icon" type="image/x-icon" href="../imgs/favicon/favicon.ico">
    <script
        src="https://apis.openapi.sk.com/tmap/vectorjs?version=1&appKey=l7xxf8a0d7c16d01466a8bae0f6451de98be"></script>
        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
        <script src="js/confetti.js"></script>

    <style>
        body {
            overflow-y: hidden;
            margin: 0;
            padding: 0;
        }

        @font-face {
            font-family: 'SBAggroB';
            src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2108@1.1/SBAggroB.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        input:focus {
            outline: none;
        }
        input {
            border: none;
            background: transparent;
            font-family: 'SBAggroB';
            color: #fff;
        }
        button {
            all: unset;
        }


        .ms-div {
            position: relative;
            top: 0;
            left: 0;
            width: 1920px;
            height: 1080px;
            z-index: 0;
        }
    </style>

    <script type="text/javascript">
        var map;
        var label;
        var markers = [];
        var ddrimarkers = [];
        var parkmarkers = [];
        var convimarkers = [];
        var accimarkers = [];
        var slatlngsear;
        // 페이지가 로딩이 된 후 호출하는 함수입니다.
        function initTmap() {
            // map 생성
            // Tmap.map을 이용하여, 지도가 들어갈 div, 넓이, 높이를 설정합니다.
            map = new Tmapv3.Map("map_div", {
                center: new Tmapv3.LatLng(37.500812, 126.867576),
                width: "100%",  // 지도의 넓이
                height: "100%", // 지도의 높이
                zoom: 16   // 지도 줌레벨
            });
        };
        //사고 다발 지역
        $(document).ready(function() {
            $("#ch1").change(function() {
                if($("#ch1").is(":checked")) { //체크박스가 체크 되었을 때
                    fetch("../js/acci.json") //fetch 함수를 통한 json 파싱
                .then(response =>{
                    return response.json();
                })
                .then(acci =>{
                    for(var i = 0; i < acci.bikeacci.length; i++) {
                        var accilat = acci.bikeacci[i].la_crd; //배열의 위도 값
                        var accilon = acci.bikeacci[i].lo_crd; //배열의 경도 값
                        var accimarker = new Tmapv3.Marker({
                            position: new Tmapv3.LatLng(accilat, accilon), //Marker의 중심좌표 설정.
                            map: map,
                            icon: "../imgs/mapview/acc.png" //마커 디자인
                        });
                        accimarkers.push(accimarker);
                    }
                });
                } else{ //체크박스가 체크 안되어 있을 때
                    removeacciMarkers(); //마커 제거
                }
            });
        });

        //따릉이
        $(document).ready(function() {
            $("#ch2").change(function() {
                if($("#ch2").is(":checked")) { //체크박스가 체크 되었을 때
                    fetch("../js/ddri.json") //fetch 함수를 통한 json 파싱
                .then(response =>{
                    return response.json();
                })
                .then(ddri =>{
                    for(var i = 0; i < ddri.bikeddri.length; i++) {
                        var ddrilat = ddri.bikeddri[i].la_crd; //배열의 위도 값
                        var ddrilon = ddri.bikeddri[i].lo_crd; //배열의 경도 값
                        var ddrimarker = new Tmapv3.Marker({
                            position: new Tmapv3.LatLng(ddrilat, ddrilon), //Marker의 중심좌표 설정.
                            map: map,
                            icon: "../imgs/mapview/ddr.png" //마커 디자인
                        });
                        ddrimarkers.push(ddrimarker);
                    }
                });
                } else{ //체크박스가 체크 안되어 있을 때
                    removeddriMarkers(); //마커 제거
                }
            });
        });

        //주차장
        $(document).ready(function() {
            $("#ch3").change(function() {
                if($("#ch3").is(":checked")) { //체크박스가 체크 되었을 때
                    fetch("../js/park.json") //fetch 함수를 통한 json 파싱
                .then(response =>{
                    return response.json();
                })
                .then(park =>{
                    for(var i = 0; i < park.bikepark.length; i++) {
                        var parklat = park.bikepark[i].la_crd; //배열의 위도 값
                        var parklon = park.bikepark[i].lo_crd; //배열의 경도 값
                        var parkmarker = new Tmapv3.Marker({
                            position: new Tmapv3.LatLng(parklat, parklon), //Marker의 중심좌표 설정.
                            map: map,
                            icon: "../imgs/mapview/park.png" //마커 디자인
                        });
                        parkmarkers.push(parkmarker);
                    }
                });
                } else{ //체크박스가 체크 안되어 있을 때
                    removeparkMarkers(); //마커 제거
                }
            });
        });

        //정비소
        $(document).ready(function() {
            $("#ch4").change(function() {
                if($("#ch4").is(":checked")) { //체크박스가 체크 되었을 때
                    fetch("../js/convi.json") //fetch 함수를 통한 json 파싱
                .then(response =>{
                    return response.json();
                })
                .then(convi =>{
                    for(var i = 0; i < convi.bikeconvi.length; i++) {
                        var convilat = convi.bikeconvi[i].la_crd; //배열의 위도 값
                        var convilon = convi.bikeconvi[i].lo_crd; //배열의 경도 값
                        var convimarker = new Tmapv3.Marker({
                            position: new Tmapv3.LatLng(convilat, convilon), //Marker의 중심좌표 설정.
                            map: map,
                            icon: "../imgs/mapview/convi.png" //마커 디자인
                        });
                        convimarkers.push(convimarker);
                    }
                });
                } else{ //체크박스가 체크 안되어 있을 때
                    removeconviMarkers(); //마커 제거
                }
            });
        });

               
        function addMarker(lonlatoption) {
            // 마커 생성
            var marker = new Tmapv3.Marker({
                position: new Tmapv3.LatLng(lonlatoption.lonlat.latitude(), lonlatoption.lonlat.longitude()), //Marker의 중심좌표 설정.
                map: map, //Marker가 표시될 Map 설정..
            });
            markers.push(marker);
            marker.on("Click", function(evt) {
                document.getElementById("startPoint").value = lonlatoption.title;
                slatlngsear = {
                    slat: lonlatoption.lonlat._lat,
                    slng: lonlatoption.lonlat._lng
                }
                // removeMarkers()
            });
        }
        function searchPOI() {
            var center = map.getCenter();//map의 중심 좌표 값을 받아 옵니다.
            var optionObj = {
                reqCoordType: "WGS84GEO", //요청 좌표계 옵셥 설정입니다.
                resCoordType: "WGS84GEO",  //응답 좌표계 옵셥 설정입니다.
                centerLon: 126.867576,  //POI검색시 중앙좌표의 경도입니다.
                centerLat: 37.500812 //POI검색시 중앙좌표의 위도입니다.
            };
            var params = {
                onComplete: onComplete,
                onProgress: onProgress,
                onError: onError
            };
            var tData = new Tmapv3.extension.TData();
            var startPoint = $('#startPoint').val();
            tData.getPOIDataFromSearchJson(encodeURIComponent(startPoint), optionObj, params);//encodeURIComponent함수로 해당 파라메터 값을 처리합니다.
        }
        function onComplete() {
            if(this._responseData.searchPoiInfo.pois.poi != '') {
                jQuery(this._responseData.searchPoiInfo.pois.poi).each(function() {//결과를 each문으로 돌려 마커를 등록합니다.
                    //response 데이터중 원하는 값을 find 함수로 찾습니다.
                    var name = this.name;
                    var id = this.id;
                    var lon = this.frontLon;
                    var lat = this.frontLat;
                    var lonlatoption = {
                        title: name,//마커 라벨 text 설정
                        lonlat: new Tmapv3.LatLng(lat, lon)//마커 라벨 좌표 설정
                    };
                    addMarker(lonlatoption);//마커를 추가하는 함수입니다.
                });
            } else{
                alert('검색결과가 없습니다.');
            }
            removeMarkers();
            map.setCenter(new Tmapv3.LatLng(this._responseData.searchPoiInfo.pois.poi[0].frontLat, this._responseData.searchPoiInfo.pois.poi[0].frontLon));
            map.setZoom(16);
        }
        // 각 마커 제거하는 함수
        function removeMarkers() {
            for(var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = [];
        }
        function removeddriMarkers() {
            for(var i = 0; i < ddrimarkers.length; i++) {
                ddrimarkers[i].setMap(null);
            }
            ddrimarkers = [];
        }
        function removeacciMarkers() {
            for(var i = 0; i < accimarkers.length; i++) {
                accimarkers[i].setMap(null);
            }
            accimarkers = [];
        }
        function removeparkMarkers() {
            for(var i = 0; i < parkmarkers.length; i++) {
                parkmarkers[i].setMap(null);
            }
            parkmarkers = [];
        }
        function removeconviMarkers() {
            for(var i = 0; i < convimarkers.length; i++) {
                convimarkers[i].setMap(null);
            }
            convimarkers = [];
        }

        //데이터 로드중 실행
        function onProgress() {
        }
        //데이터 로드 중 에러 발생
        function onError() {
            alert("onError");
        }
        //input 타입에 엔터키 반응
        function enterkey() {
            if(window.event.keyCode == 13) {
                searchPOI();
            }
        }
    </script>

</head>

<body onload="initTmap()">
    <!--헤더-->
    <header class="container">
        <a href="../index.html" class="index-css">
            Care Bicycle Case 축약형 포트폴리오
        </a>
        <nav>
            <ul class="mmenu">
                <!-- <li class="menu1">
                    <a id="aggro" href="html/main/info.html">
                        길 찾기
                    </a>
                </li>
                <li class="menu3">
                    <a id="aggro" href="html/main/mapsearch.html">
                        테마지도
                    </a>
                </li>
                <li class="menu4">
                    <a id="aggro" href="html/main/product.html">
                        실시간 사고
                    </a>
                </li> -->
                <li>
                    <a id="aggro" class="list-title">
                        테마지도
                    </a>
                </li>
                <li class="useri">
                    <!-- <a id="aggro" href="html/rog/rogin.html">
                        <img id="userinfo" src="imgs/usericon.png">
                    </a> -->
                    <span id="user_msg">라이더님 환영합니다!</span>
                    <a id="aggro" href="javascript:void(0);" onclick="sign(); return false;">
                        <span id="sign">로그인</span>
                        <!--로그인 후 로그아웃으로 변경
                        if 토큰 값이 널 값이 아닌 경우 로그아웃, 널인 경우 로그인-->
                    </a>
                    <span>|</span>
                    <a id="aggro" href="javascript:void(0);" onclick="user(); return false;">
                        <span id="user">회원가입</span>
                        <!--로그인 후 회원정보로 변경
                        if 토큰 값이 널 값이 아닌 경우 회원정보, 널인 경우 회원가입-->
                    </a>
                </li>
            </ul>
        </nav>
        <script type="text/javascript" src="js/header.js"></script>
    </header>
    <!--페이지-->
    <main>
        <div class="ms-div">
            <div id="map_div" class="map-div">
            </div>
        </div>
    </main>
    <!--푸터-->
    <footer class="foot-container">
        <a href="../index.html">
            <img src="../imgs/cbc_logo_ui.png" class="cbc-logo-ui">
        </a>
        <nav>
            <p>
                <span>NAME : 유현호</span>
                <span>TEAM : 자슬라</span>
                <span>ROLE : 웹 프론트 & 시스템 프레임 디자인 및 제작</span>
            </p>
            <p>
                동양미래대학교 컴퓨터공학부 컴퓨터정보공학과 사회맞춤형 지능형컴퓨팅과정
            </p>
            <p>
                2022 스마트 ICT 프로젝트 경진대회 최우수상
            </p>
        </nav>
        <nav class="footer-contact">
            <span>
                Contact
            </span>
            <a href="hyno0913@naver.com">
                <img src="../imgs/ui_email.png" class="email-ui">
            </a>
            <a href="https://github.com/gusgh00">
                <img src="../imgs/ui_github.png" class="git-ui">
            </a>
            <a href="https://www.dongyang.ac.kr">
                <img src="../imgs/ui_school.png" class="school-ui">
            </a>
        </nav>
    </footer>
    <script>
        if (localStorage.getItem('user_nickname') == "관리자") {
            document.getElementById('sign').innerHTML = '로그아웃'
            document.getElementById('user').innerHTML = '관리페이지'

            function sign() {
                localStorage.clear()
                alert("로그아웃 되었습니다!")
                location.href = "../index.html";
            }
            function user() {
                location.href = "../index.html";
            }
        }
    </script>
</body>

</html>